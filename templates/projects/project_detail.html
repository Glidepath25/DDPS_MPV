{% extends 'base.html' %}
{% block title %}{{ object.reference }} | DDPS{% endblock %}
{% block content %}
<div class='d-flex justify-content-between align-items-start mb-4'>
    <div>
        <h1 class='h3 mb-1'>{{ object.reference }} - {{ object.name }}</h1>
        <p class='text-muted mb-0'>Client: <a href='{% url 'client-detail' object.client.pk %}'>{{ object.client.name }}</a></p>
    </div>
    <div class='text-end'>
        <a class='btn btn-outline-primary' href='{% url 'job-create' %}?project={{ object.pk }}'>New job</a>
    </div>
</div>

<div class='row g-3 mb-4'>
    <div class='col-md-4'>
        <div class='card shadow-sm h-100'>
            <div class='card-body'>
                <h2 class='h6 text-uppercase text-muted'>Status</h2>
                <p class='h4 mb-0'>{{ object.get_status_display }}</p>
                {% if object.start_date %}
                <p class='mb-0 text-muted'>Start: {{ object.start_date }}{% if object.end_date %}; End: {{ object.end_date }}{% endif %}</p>
                {% endif %}
            </div>
        </div>
    </div>
    <div class='col-md-8'>
        <div class='card shadow-sm h-100'>
            <div class='card-body'>
                <h2 class='h6 text-uppercase text-muted'>Description</h2>
                <p class='mb-0'>{{ object.description|default:'No description provided.' }}</p>
            </div>
        </div>
    </div>
</div>

<h2 class='h4 mb-3'>Jobs</h2>
<div class='table-responsive bg-white shadow-sm rounded'>
    <table class='table table-hover align-middle mb-0'>
        <thead>
            <tr>
                <th scope='col'>Reference</th>
                <th scope='col'>Title</th>
                <th scope='col'>Owner</th>
                <th scope='col'>Status</th>
                <th scope='col'>Forecast &pound;</th>
                <th scope='col'>Actual &pound;</th>
                <th scope='col'></th>
            </tr>
        </thead>
        <tbody>
            {% for job in object.jobs.all %}
            <tr>
                <td>{{ job.reference }}</td>
                <td>{{ job.title }}</td>
                <td>{% if job.owner %}{{ job.owner.get_full_name|default:job.owner.username }}{% else %}-{% endif %}</td>
                <td>{{ job.get_status_display }}</td>
                <td>&pound;{{ job.forecast_revenue }}</td>
                <td>{% if request.user.can_view_finance %}&pound;{{ job.actual_revenue }}{% else %}-{% endif %}</td>
                <td>
                    <a class='btn btn-sm btn-outline-primary' href='{% url 'job-detail' job.pk %}'>View</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan='7' class='text-center py-4 text-muted'>No jobs yet.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
